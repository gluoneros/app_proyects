<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Kanvan Board{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="{{ url_for('static', filename='tailwind.css') }}" rel="stylesheet">
</head>
<body class="bg-gray-100 text-gray-900 min-h-screen">

<!-- Barra de navegaciÃ³n -->
<nav class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white shadow-lg">
    <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
        <a href="{{ url_for('main.dashboard') }}" class="text-2xl font-bold tracking-tight">
            ðŸ“‹ Canban Board
        </a>

        <div class="flex space-x-6 items-center">
            {% if current_user.is_authenticated %}
                <a href="{{ url_for('main.dashboard') }}" 
                    class="hover:bg-blue-500 px-3 py-2 rounded transition">Dashboard</a>
                <span class="text-sm opacity-90">Hola, <strong>{{ current_user.username }}</strong></span>
                <a href="{{ url_for('auth.logout') }}" 
                    class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded font-medium text-sm transition">
                    Salir
                </a>
            {% endif %}
        </div>
    </div>
</nav>

<!-- Contenido principal -->
<div class="container mx-auto py-6">
    {% block content %}{% endblock %}
</div>

<script>
    function toggleNewCardForm(listId) {
        const form = document.getElementById(`form-new-card-${listId}`);
        if (form.classList.contains('hidden')) {
            form.classList.remove('hidden');
        } else {
            form.classList.add('hidden');
        }
    }

    function drop(event) {
        event.preventDefault();

        // Aseguramos que el contenedor tenga el data-list-id
        let targetList = event.currentTarget;
        if (!targetList.hasAttribute('data-list-id')) {
            targetList = targetList.closest('[data-list-id]');
        }

        const listId = targetList.dataset.listId;

        if (draggedCardId && listId) {
            fetch(`/card/move/${draggedCardId}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ list_id: listId })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const card = document.querySelector(`[data-card-id="${draggedCardId}"]`);
                    const cardContainer = document.getElementById(`list-cards-${listId}`);
                    
                    if (card && cardContainer) {
                        cardContainer.appendChild(card);  // Ahora se agrega al contenedor correcto
                        draggedCardId = null;
                    }
                } else {
                    alert('Error al mover la tarjeta: ' + (data.error || 'Desconocido'));
                }
            })
                .catch(err => {
                console.error('Error:', err);
                alert('No se pudo mover la tarjeta');
            });
        }
    }
</script>

</body>
</html>